(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["preventionMn"],{"209e":function(e,t,a){},"37a3":function(e,t,a){},"9e35":function(e,t,a){"use strict";var i=a("37a3"),r=a.n(i);r.a},b0d7:function(e,t,a){"use strict";var i=a("209e"),r=a.n(i);r.a},c41e:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"prevention"},[a("div",{staticClass:"title"},[a("h1",{style:{fontSize:"20px"}},[e._v(e._s(e.preMnTitle))]),a("div",{staticClass:"search-edit"},[a("el-date-picker",{attrs:{size:"small",type:"year","value-format":"yyyy",placeholder:"选择日期时间"},on:{change:e.changeTime},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}}),e.getUserJurisdiction("AT12")?a("el-button",{style:{marginLeft:"10px"},attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.clickAdd}}):e._e()],1)]),a("div",{staticClass:"table"},[a("el-table",{attrs:{data:e.dataList,border:"",stripe:"","header-cell-class-name":"table-th"}},[a("el-table-column",{attrs:{align:"center",width:"120px",prop:"acSide",label:"交流侧(A)"}}),a("el-table-column",{attrs:{align:"center",width:"120px",prop:"secondaryEquipment",label:"二次设备(B)"}}),a("el-table-column",{attrs:{align:"center",width:"120px",prop:"dcSide",label:"直流侧(C)"}}),e._l(e.columns,function(t,i){return a("el-table-column",{key:i,attrs:{label:String(t.label),align:"center"}},e._l(t.children,function(i,r){return a("el-table-column",{key:r,attrs:{align:"center",label:String(i.week),width:String(t.label).includes("/")?"80px":"40px",prop:t.prop},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.deviceMaintainDetailList&&t.row.deviceMaintainDetailList[i.week-1]&&t.row.deviceMaintainDetailList[i.week-1].maintainId?a("span",{staticClass:"record",style:{backgroundColor:0===t.row.deviceMaintainDetailList[i.week-1].status?"#999999":1===t.row.deviceMaintainDetailList[i.week-1].status?"#339933":2===t.row.deviceMaintainDetailList[i.week-1].status?"#0000FF":"#FFF"},on:{click:function(a){return e.clickShowRecord(t.row.deviceMaintainDetailList[i.week-1],i.week-1)}}},[e._v("\n              "+e._s(t.row.deviceMaintainDetailList[i.week-1].maintainId?t.row.deviceMaintainDetailList[i.week-1].deviceType:"")+"\n            ")]):e._e()]}}],null,!0)})}),1)}),a("el-table-column",{attrs:{fixed:"right",align:"center",width:"140px",prop:"content",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.getUserJurisdiction("AT13")?a("el-button",{attrs:{size:"small",type:"",icon:"el-icon-edit-outline"},on:{click:function(a){return e.clickEdit(t.row)}}}):e._e(),e.getUserJurisdiction("AT14")?a("el-button",{attrs:{size:"small",type:"warning",icon:"el-icon-delete"},on:{click:function(a){return e.clickDelete(t.row)}}}):e._e()]}}])})],2)],1),a("el-dialog",{attrs:{title:"预防性保养记录表",visible:e.isRecordDialog,width:"40%"},on:{"update:visible":function(t){e.isRecordDialog=t},close:function(t){return e.handleClose("recordform")}}},[a("div",{staticClass:"main"},[a("el-form",{ref:"recordform",attrs:{model:e.recordform,size:"small","label-width":"100px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"维保类型："}},[a("el-input",{attrs:{disabled:"",placeholder:""},model:{value:e.recordform.deviceType,callback:function(t){e.$set(e.recordform,"deviceType",t)},expression:"recordform.deviceType"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"维保人："}},[a("el-input",{attrs:{disabled:"",placeholder:""},model:{value:e.realname,callback:function(t){e.realname=t},expression:"realname"}})],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"计划时间："}},[a("el-input",{attrs:{disabled:"",placeholder:""},model:{value:e.recordform.firstDay,callback:function(t){e.$set(e.recordform,"firstDay",t)},expression:"recordform.firstDay"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"执行时间："}},[a("el-input",{attrs:{disabled:"",placeholder:""},model:{value:e.recordform.maintainTime,callback:function(t){e.$set(e.recordform,"maintainTime",t)},expression:"recordform.maintainTime"}})],1)],1)],1),a("el-form-item",{attrs:{label:"维保内容：",prop:"content",rules:[{required:!0,message:"请输入维保内容"}]}},[a("el-input",{attrs:{disabled:0!==e.recordform.status,type:"textarea",rows:2,placeholder:"请输入维保内容"},model:{value:e.recordform.content,callback:function(t){e.$set(e.recordform,"content",t)},expression:"recordform.content"}})],1),a("el-form-item",{attrs:{label:"维保过程：",prop:"flow",rules:[{required:!0,message:"请输入维保过程"}]}},[a("el-input",{attrs:{disabled:0!==e.recordform.status,type:"textarea",rows:2,placeholder:"请输入维保过程"},model:{value:e.recordform.flow,callback:function(t){e.$set(e.recordform,"flow",t)},expression:"recordform.flow"}})],1),a("el-form-item",{attrs:{label:"维保结果：",prop:"result",rules:[{required:!0,message:"请输入维保结果"}]}},[a("el-input",{attrs:{disabled:0!==e.recordform.status,type:"textarea",rows:2,placeholder:"请输入维保结果"},model:{value:e.recordform.result,callback:function(t){e.$set(e.recordform,"result",t)},expression:"recordform.result"}})],1),a("el-form-item",{attrs:{label:"维保资料："}},[a("div",{staticClass:"img"},[e._l(e.recordform.fileList,function(t,i){return a("img",{key:i,attrs:{src:t?e.hostDomain+t:"",alt:""}})}),2!==e.recordform.status?a("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.actionUrl,"show-file-list":!1,"on-success":function(t){return e.uploadSuccess(t)},"before-upload":function(t){return e.beforeAvatarUpload(t,3)}}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]):e._e()],2)]),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-row",[a("el-col",{attrs:{span:12}},[0!==e.recordform.status?a("el-form-item",{attrs:{label:"确认人："}},[a("el-input",{attrs:{disabled:"",placeholder:""},model:{value:e.recordform.confirmer,callback:function(t){e.$set(e.recordform,"confirmer",t)},expression:"recordform.confirmer"}})],1):e._e()],1)],1)],1)],1)],1)],1),2!==e.recordform.status?a("div",{attrs:{slot:"footer",align:"center"},slot:"footer"},[1==e.recordform.status&&e.getUserJurisdiction("AT11")||0==e.recordform.status?a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.clickRecordConfirm("recordform")}}},[e._v(e._s(0==e.recordform.status?"确认并提交":"确认"))]):e._e()],1):e._e()]),a("el-dialog",{attrs:{title:"新建保养内容",visible:e.isShowAddMaintain,width:"40%"},on:{"update:visible":function(t){e.isShowAddMaintain=t}}},[a("div",{staticClass:"main"},[a("el-form",{ref:"addform",attrs:{model:e.addform,size:"small",align:"left","label-width":"120px"}},[a("el-form-item",{attrs:{label:"交流侧：",prop:"acside"}},[a("el-input",{model:{value:e.addform.acside,callback:function(t){e.$set(e.addform,"acside",t)},expression:"addform.acside"}})],1),a("el-form-item",{attrs:{label:"保养周：",prop:"acsideWeek"}},[a("el-select",{style:{width:"100%"},attrs:{multiple:"",placeholder:"请选择"},on:{change:e.changeWeek},model:{value:e.addform.acsideWeek,callback:function(t){e.$set(e.addform,"acsideWeek",t)},expression:"addform.acsideWeek"}},e._l(e.weekDataList,function(e,t){return a("el-option",{key:t,attrs:{disabled:e.disabled,label:e.label,value:e.value}})}),1)],1),a("el-divider",{staticStyle:{height:"3px"}}),a("el-form-item",{attrs:{label:"二次设备：",prop:"secondaryEquipment"}},[a("el-input",{model:{value:e.addform.secondaryEquipment,callback:function(t){e.$set(e.addform,"secondaryEquipment",t)},expression:"addform.secondaryEquipment"}})],1),a("el-form-item",{attrs:{label:"保养周：",prop:"secondaryEquipmentWeek"}},[a("el-select",{style:{width:"100%"},attrs:{multiple:"",placeholder:"请选择"},on:{change:e.changeWeek},model:{value:e.addform.secondaryEquipmentWeek,callback:function(t){e.$set(e.addform,"secondaryEquipmentWeek",t)},expression:"addform.secondaryEquipmentWeek"}},e._l(e.weekDataList,function(e,t){return a("el-option",{key:t,attrs:{disabled:e.disabled,label:e.label,value:e.value}})}),1)],1),a("el-divider",{staticStyle:{height:"3px"}}),a("el-form-item",{attrs:{label:"直流侧：",prop:"dcSide"}},[a("el-input",{model:{value:e.addform.dcSide,callback:function(t){e.$set(e.addform,"dcSide",t)},expression:"addform.dcSide"}})],1),a("el-form-item",{attrs:{label:"保养周：",prop:"dcSideWeek"}},[a("el-select",{style:{width:"100%"},attrs:{multiple:"",placeholder:"请选择"},on:{change:e.changeWeek},model:{value:e.addform.dcSideWeek,callback:function(t){e.$set(e.addform,"dcSideWeek",t)},expression:"addform.dcSideWeek"}},e._l(e.weekDataList,function(e,t){return a("el-option",{key:t,attrs:{disabled:e.disabled,label:e.label,value:e.value}})}),1)],1)],1)],1),a("div",{attrs:{slot:"footer",align:"center"},slot:"footer"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.clickAddMaintain("addform")}}},[e._v("更新信息")]),a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.clickCancle("addform")}}},[e._v("取消")])],1)])],1)},r=[],n=a("cebc"),s=(a("7f7f"),a("ac6a"),a("96cf"),a("3b8d")),o=(a("6762"),a("2fdb"),a("f121")),l=a("c1df"),c=a.n(l),d=a("bfe6"),m={mixins:[d["a"]],data:function(){return{time:"",disWeekList:[],isShowAddMaintain:!1,isRecordDialog:!1,dataList:[1],stationId:"",preMnTitle:"",addform:{},realname:"",actionUrl:"/pvams/upload",columns:[],weekDataList:[],recordform:{},userId:"",hostDomain:""}},created:function(){this.hostDomain="".concat(o["a"].HOST.pvamsDomain),this.userId=localStorage.getItem("userId"),this.realname=localStorage.getItem("realname");var e=this.$store.state.getTreeId.treeId;e.id&&e.id.includes("s")&&(this.stationId=e.id.slice(1,e.id.length),this.stationId&&(this.getTableData(),this.getWeekData()))},watch:{getStateData:function(e){var t=this.$store.state.getTreeId.treeId.id;t&&t.includes("s")&&(this.stationId=t.slice(1,t.length),this.getTableData(),this.getWeekData())}},computed:{getStateData:function(){return this.$store.state.getTreeId.treeId}},methods:{getWeekData:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,a,i,r,n,s,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingOpen(),e.next=3,this.axios("/pvams/getDateWeek");case 3:if(t=e.sent,a=t.data.data,this.loadingClose(),a&&0!==a.length){if(i=a[a.length-1],i&&0!==i.length&&i.children&&0!==i.children.length)for(r=i.children[i.children.length-1],n=r.week,s=1;s<=n;s++)o={label:"第".concat(s,"周"),value:s},this.weekDataList.push(o);a.forEach(function(e){e["label"]="".concat(e.month,"月")}),this.columns=a||[]}case 7:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),changeTime:function(e){this.getTableData()},getTableData:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,a,i,r,n,s,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingOpen(),t={stationId:this.stationId,year:this.time||""},e.next=4,this.axios("/pvams/maintain/getStationMaintainPlan",{params:t});case 4:a=e.sent,i=a.data.data,r=i.list,n=void 0===r?[]:r,s=i.title,o=void 0===s?"":s,this.loadingClose(),this.preMnTitle=o,n&&(this.dataList=n);case 13:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),changeWeek:function(e){var t=this,a=this.addform.acsideWeek,i=this.addform.dcSideWeek,r=this.addform.secondaryEquipmentWeek;this.disWeekList=a.concat(i.concat(r)),this.weekDataList.forEach(function(e){t.disWeekList.includes(e.value)?e.disabled=!0:e.disabled=!1})},clickAdd:function(){this.addform={acsideWeek:[],dcSideWeek:[],secondaryEquipmentWeek:[]},this.weekDataList&&this.weekDataList.forEach(function(e){return e.disabled=!1}),this.isShowAddMaintain=!0},clickEdit:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var a,i,r,n,s,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=t.maintainId,i=void 0===a?"":a,e.next=3,this.axios("/pvams/maintain/query",{params:{maintainId:i}});case 3:r=e.sent,n=r.data,s=n.code,o=n.data,200===s&&(this.isShowAddMaintain=!0,this.addform.acside=o.acSide.name||"",this.addform={acside:o.acSide.name||"",acsideWeek:o.acSide.week||"",dcSide:o.dcSide.name||"",dcSideWeek:o.dcSide.week||"",secondaryEquipment:o.secondaryEquipment.name||"",secondaryEquipmentWeek:o.secondaryEquipment.week||"",maintainId:o.maintainId});case 8:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),clickDelete:function(e){var t=this;this.$confirm("此操作将永久删除, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark(function a(){var i,r,n,s,o;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return i=e.maintainId,r=void 0===i?"":i,n={maintainId:r},a.next=4,t.axios("/pvams/maintain/delete",{params:n});case 4:s=a.sent,o=s.data.code,200===o&&(t.$message({type:"success",message:"删除成功"}),t.getTableData());case 7:case"end":return a.stop()}},a)})))},clickCancle:function(e){this.$refs[e].resetFields(),this.isShowAddMaintain=!1},clickAddMaintain:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var a,i,r,n,s,o,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a={name:this.addform.acside,week:this.addform.acsideWeek},i={name:this.addform.dcSide,week:this.addform.dcSideWeek},r={name:this.addform.secondaryEquipment,week:this.addform.secondaryEquipmentWeek},n={acSide:a,secondaryEquipment:r,dcSide:i,stationId:this.stationId,year:this.time,maintainId:this.addform.maintainId||null},this.addform.acside||this.addform.secondaryEquipment||this.addform.dcSide){e.next=7;break}return this.$message({type:"error",message:"请选择其中一项"}),e.abrupt("return");case 7:if(0!==this.addform.acsideWeek.length||0!==this.addform.secondaryEquipmentWeek.length||0!=this.addform.dcSideWeek.length){e.next=10;break}return this.$message({type:"error",message:"请选择保养周"}),e.abrupt("return");case 10:return s=this.addform.maintainId?"/pvams/maintain/updateMaintainPlan":"/pvams/maintain/addMaintainPlan",e.next=13,this.axios.post(s,n);case 13:o=e.sent,l=o.data,l.ok&&(this.isShowAddMaintain=!1,this.$refs[t].resetFields(),this.getTableData());case 16:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),clickRecordConfirm:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.$refs[t].validate(function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var i,r,s,o,l,c;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!t){e.next=9;break}return i=a.recordform.status,r=void 0===i?"":i,s=Object(n["a"])({},a.recordform,{maintainer:a.recordform.maintainer||a.realname,confirmUserId:0===r?null:a.userId}),o=0===r?"/pvams/maintain/submitMaintainPlan":"/pvams/maintain/confirmMaintainPlan",e.next=6,a.axios.post(o,s);case 6:l=e.sent,c=l.data,200===c.code&&(a.isRecordDialog=!1,a.$message({type:"success",message:"提交成功"}),a.getTableData());case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),uploadSuccess:function(e){if(200===e.code){this.$message({type:"success",message:"上传成功"});var t=e.data;this.recordform&&!this.recordform.fileList&&(this.recordform.fileList=[]),this.recordform.fileList.push(t)}else this.$message({type:"error",message:e.message})},beforeAvatarUpload:function(e,t){if(1===t){var a=e.size/1024/1024<20;return a||this.$message.error("上传文件大小不得超过20mb!"),a}if(2===t)return!0;if(3===t){var i=e.size/1024/1024<10,r="image/jpeg"===e.type||"image/png"===e.type;return r||this.$message.error("上传头像图片只能是 JPG或者Png 格式!"),i||this.$message.error("上传大小不得超过10mb!"),r&&i}},handleClose:function(e){this.$refs[e].resetFields()},clickShowRecord:function(e,t){this.recordform=Object(n["a"])({},e,{confirmer:e.confirmer&&0!==e.status?e.confirmer:this.realname}),this.recordform.maintainTime=0===e.status?c()(new Date).format("YYYY-MM-DD HH:mm:ss"):this.recordform.maintainTime,this.isRecordDialog=!0}}},u=m,f=(a("b0d7"),a("9e35"),a("2877")),p=Object(f["a"])(u,i,r,!1,null,"84ce140e",null);t["default"]=p.exports},f121:function(e,t,a){"use strict";var i={};a.r(i),a.d(i,"HOST",function(){return s}),a.d(i,"ENV",function(){return o});var r={};a.r(r),a.d(r,"HOST",function(){return l}),a.d(r,"ENV",function(){return c});var n,s={pvamsDomain:"http://148.70.2.3:8090"},o="sit",l={pvamsDomain:"http://101.37.67.138:8088"},c="prd";n="101.37.67.138"===window.location.hostname?r:i;t["a"]=n}}]);
//# sourceMappingURL=preventionMn.29e372a8.js.map